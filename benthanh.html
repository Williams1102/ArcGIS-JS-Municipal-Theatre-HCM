<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<title>3Dview</title>

	<style>
		html,
		body,
		#viewDiv {
			padding: 0;
			margin: 0;
			height: 100%;
			width: 100%;
		}

		#back {
			position: absolute;
			bottom: 20px;
		}

		#back i {
			background-image: url(app/public/img/back.svg);
			background-repeat: no-repeat;
			display: inline-block;
			width: 100px;
			height: 25px;
			padding-left: 25px;
			padding-top: 2px;
			margin: 10px;
			cursor: pointer;
			background-size: 20px;
		}
	</style>

	<link rel="stylesheet" href="https://js.arcgis.com/4.16/esri/themes/light/main.css" />
	<script src="https://js.arcgis.com/4.16/"></script>

	<script>
		require([
			"esri/Map",
			"esri/views/SceneView",
			"esri/layers/GeoJSONLayer",
			"esri/layers/SceneLayer", "esri/layers/GraphicsLayer", "esri/Graphic", "esri/request"
		], function (Map, SceneView, GeoJSONLayer, SceneLayer,
			GraphicsLayer, Graphic, esriRequest) {
			var url = 'http://localhost:3000/';
			var urlGeo = 'http://localhost:3000/';
			var urlJS = 'http://localhost:3000/';



			var createGraphic = function (data) {
				return new Graphic({
					geometry: data,
					symbol: data.symbol,
					attributes: data
				});
			};

			function getJsonData(param, onCloud = false) {
				//true when call api via server false when call via json-server localhost
				let _url;
				if (onCloud) _url = urlJS;
				else _url = url;

				esriRequest(_url + param, json_options).then(function (response) {
					var graphicsLayer = new GraphicsLayer();
					// console.log(_url + param);
					// console.log(response);
					if (onCloud) {
						response.data[0].data.forEach(function (data) {
							graphicsLayer.add(createGraphic(data));
						});
					}
					else {
						response.data.forEach(function (data) {
							graphicsLayer.add(createGraphic(data));
						});
					}
					map.add(graphicsLayer);
				});
			}

			function getGeoJsonData(param, rendererType, onCloud = false) {
				let _url;
				if (onCloud) _url = urlGeo;
				else _url = url;

				const newGeoJsonLayer = new GeoJSONLayer({
					url: _url + param
				});
				
				newGeoJsonLayer.renderer = rendererType;
				map.layers.add(newGeoJsonLayer);
			}

				function getGeoJsonDataWithRenderType(param, rendererType, onCloud = false) {
				let _url;
				if (onCloud) _url = urlGeo;
				else _url = url;
				
				const dataUrl = fetch(_url + param).then((data )=> {
					 data.json().then(json => {
						 	const newGeoJsonLayer = new GeoJSONLayer({url: _url + param});
				
				newGeoJsonLayer.renderer = {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: json.features[0].properties.height,
							material: {
								color: json.features[0].properties.color || "#F4F2EF",
							}
						}
					]
				}
			}
				map.layers.add(newGeoJsonLayer);

				}) 
				})
			
			}

			//declare
			const json_options = {
				query: {
					f: "json"
				},
				responseType: "json"
			};

			const map = new Map({
				basemap: "dark-gray-vector",
				layers: [] //end layers
			});


			// request json
			getJsonData("mainha");
		
			
			getGeoJsonData("left_gate1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 3.9,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})
		
			//them khoi mai 
			getGeoJsonData("a", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("b", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("c", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

				for (let index = 1; index <= 14; index++) {
				
				getGeoJsonDataWithRenderType("front_gate"+index)
			}
			getGeoJsonDataWithRenderType("lock_tower0")
			getGeoJsonDataWithRenderType("lock_tower1")

			getGeoJsonData("d", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("e", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("f", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("g", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("h", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("h1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("g1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("2", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("3", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("4", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("5", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("6", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("7", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})
			
			getGeoJsonData("8", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("9", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("10", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("11", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("12", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("13", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("14", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("15", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("16", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("17", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("18", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("19", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("20", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("21", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("22", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("23", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})
			
			getGeoJsonData("24", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23809312066896382,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("25", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("26", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("27", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("28", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50182962396684161,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("29", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50181669887479075,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("30", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.50181669887479075,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("31", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("32", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("33", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("34", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("35", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("36", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("37", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})


			getGeoJsonData("38", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.23810604576101468,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotruoc1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935661882394925,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotruoc1_1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935661882394925,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotruoc1_2", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotruoc1_3", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhosau1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935532631474416,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhosau1_1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935532631474416,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhosau1_2", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhosau1_3", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			
			getGeoJsonData("Mainhanhophai1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935661882394925,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhophai2", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935532631474416,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhophai3", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhophai4", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotrai1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935661882394925,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotrai2", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.0935532631474416,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})

			getGeoJsonData("Mainhanhotrai3", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 0.447440836616806,
							material: {
								color: "#ed5334"
							}
						}
					]
				}
			})
			
			// request json buc tuong ben phai
			// getJsonData("buctuongbenphaicuatruoc");
				
			getGeoJsonData("Buctuongtruocphai_1", {
				type: "simple",
				symbol: {
					type: "polygon-3d",
					symbolLayers: [
						{
							type: "extrude",
							size: 1.8169318899581413,
							material: {
								color: "#F4F2EF"
							}
						}
					]
				}
			})
		
					

			//view
			const view = new SceneView({
				container: "viewDiv",
				map: map,
				camera: {
					position: [106.69851318273459, 10.771691940543342, 100],
					heading: 0,
					tilt: 0
				}
			});

			view.popup.defaultPopupTemplateEnabled = true;
		});

	</script>
</head>

<body>
	<div id="viewDiv"></div>
</body>

</html>